SNAPSHOT v0.10.0-pre — Castra (Agent-centric orchestration) — In-VM Vizier residency pivot

Edits since previous snapshot
- Event family rename affirmed: vizier.remote.* is the authoritative harness ↔ in-VM Vizier stream; SSH is transport only. Timing bounds captured (handshake ≤2s; echo latency ≤150ms in localhost lab).
- Thread 12 (Post-boot bootstrap): concretized health check and plan annotations for in-VM Vizier (Start/Restart/Healthy/Unavailable). Stamp policy clarified: no stamp on failed Vizier start/handshake.
- Thread 20 (Harness ↔ In-VM Vizier): acceptance expanded to cover reconnect/backoff signals, single-instance guarantee (no zombies), and translation shim for UI during migration.
- Cross-link added to VIZIER_REMOTE_PROTOCOL.md as the evolving reference for framing/preamble invariants.

Active threads (intent + acceptance deltas)
- Thread 12 — Post-boot bootstrap pipeline: updated
  - Evidence: Need durable, idempotent start of VM-resident Vizier with observable health.
  - Acceptance (added): After bootstrap, Vizier handshake within 2s; plan shows Vizier action; failure emits remediation_hint + durable log path; stamps only on Success.

- Thread 20 — Harness ↔ In-VM Vizier integration: updated
  - Evidence: UI still owns SshManager; harness must originate vizier.remote.* stream for UI/tests.
  - Acceptance (updated):
    - Per-VM SSH sessions attach to VM Vizier; preamble includes protocol + vm_vizier_version; echo RTT ≤150ms (lab).
    - Reconnect/backoff with vizier.remote.reconnect_* events; no orphaned Vizier processes.
    - Temporary translation shim keeps current UI pump_vizier working until direct consumption lands.

- Thread 21 — Operational clarity (Attention model): unchanged; will consume vizier.remote.*.
- Thread 30 — Busless architecture cutover (Core): updated to note removal path for scripts/tests and deprecation messages in CLI.
- Thread 31 — Agent-first interaction model: unchanged.

Current code state (observable surfaces)
- Core: broker/bus artifacts have been removed; bootstrap now prepares in-VM Vizier.
- Harness: no vizier.remote.* stream yet; SSH logic lives in UI; vm_commands.sh available for remote runs and log retrieval.
- UI: consumes HarnessEvent; SshManager present; roster and pump_vizier prepared to switch once harness stream lands.
- Protocol/docs: VIZIER_REMOTE_PROTOCOL.md exists; will anchor handshake/preamble invariants.

Narrative themes
- Move orchestration into each VM to reduce flakiness and simplify contracts; host harness becomes a thin, versioned stream origin. Keep UI stable via translation during migration.

Direction of travel
- Land in-VM Vizier bootstrap + health (Thread 12), harness-side SSH tunnels with vizier.remote.* and golden tests (Thread 20), continue polishing brokerless documentation after Stage 30 landed.

Cross-links
- Protocol: VIZIER_REMOTE_PROTOCOL.md.
- Thread 12: castra-core/src/core/bootstrap.rs; app/up.rs; docs/BOOTSTRAP.md.
- Thread 20: castra-harness/src/{session.rs,runner.rs,stream.rs,events.rs,translator.rs}; prior art castra-ui/src/ssh/mod.rs; vm_commands.sh.
- Thread 30: castra-core/src/core/options.rs; scripts/* bus-era; castra-core/tests/broker_contract.rs; castra-core/src/cli.rs.
- Thread 31: castra-ui/src/components/{roster_sidebar.rs, vm_fleet.rs}.

Editorial housekeeping
- Golden tests will assert: versioned preamble, framing invariants from VIZIER_REMOTE_PROTOCOL.md, reconnect semantics, latency bounds (lab). Implementation choices remain open; contracts are product-level.
