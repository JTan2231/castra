SNAPSHOT v0.9.12 — Castra (VM orchestration harness)

Edits since v0.9.11
- Thread 20: Integrated the new injectable BrokerLauncher into the UI integration plan. Clarified that castra-ui should call operations::up_with_launcher and forward JSON events into UI state; no reliance on current_exe(). Expanded acceptance to include error surfacing and no extra windows.
- Event Contract v1: Elevated to immediate blocker for UI wiring; added requirement for an explicit version signal in the stream and golden tests. Docs cross-links updated.
- Housekeeping: Removed duplicate TODO files for UI integration, vertical slice, core composability, and event contract. Consolidated work under single canonical TODOs.

Active threads (intent + acceptance deltas)
- Thread 2 — Cooperative shutdown lifecycle: unchanged.

- Thread 12 — Post-boot bootstrap pipeline: unchanged.

- Thread 13 — Stateless runs (ephemeral-only): unchanged.

- Thread 20 — UI ↔ Core integration (Composable first):
  Intent: Connect castra-ui to castra-core via the JSON event stream; keep castra-core embeddable.
  Acceptance (updated):
  - Event Contract v1 is documented, versioned, and guarded by golden tests. [OPEN, BLOCKER]
  - castra-core exposes a public library surface to run operations and emit events to an external subscriber. [DONE]
  - Broker launch is injectable/configurable; no current_exe() coupling for library embedding. [DONE]
  - UI can initiate Up and render live per-VM progress without spawning additional windows; errors surface as single actionable messages; UI remains responsive and allows retry. [NEXT]
  Verification updates: Library callers use operations::up_with_launcher with a custom launcher; tests in runtime.rs confirm injected launcher usage.
  Anchors: castra-core/src/core/runtime.rs; castra-core/src/app/up.rs; castra-core/src/core/events.rs; castra-ui/src/controller/command.rs; castra-ui/src/components/*; docs/dev/consuming_event_contract.md.

- Thread 21 — Operational clarity (Attention model): unchanged.

- Thread 22 — UI onboarding docs (tutorial set): unchanged.

Current code state (observable surfaces)
- Core emits structured JSON events; operations::up_with_launcher accepts an external BrokerLauncher; CLI path uses ProcessBrokerLauncher with its own executable; env-based launcher available for embedders (CASTRA_CLI_EXECUTABLE).
- UI scaffolding present; vertical slice awaits Event Contract v1 freeze and controller wiring to operations::up_with_launcher.

Narrative themes
1) Robust lifecycle; 10) Trustworthy bootstrap; 12) Day‑1 productivity; 13) Ephemeral-only policy; 20) Composability-first UI integration; 21) Operational clarity; 22) Onboarding via tutorials.

Direction of travel
- Freeze and document Event Contract v1 with explicit version signaling and golden tests; then wire castra-ui to consume the stream, render VM fleet progress, status footer, and message log without spawning new windows.

Cross-links
- runtime.rs tests (start_broker_uses_supplied_launcher) support the launcher injection. broker_contract.rs will hold golden JSON once Event Contract v1 lands.

Editorial housekeeping
- Duplicate TODOs removed; canonical TODOs retained: ui_core_integration_v1, event_contract_v1, ui_vertical_slice_up_status, operational_clarity_attention_model, cooperative_shutdown_lifecycle, post_boot_bootstrap_pipeline, ephemeral_vm_storage_and_cleanup, ui_signal_filtering_grouping, core_library_composability.