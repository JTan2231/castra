SNAPSHOT v0.10.0-pre — Castra (VM orchestration harness) — Busless vizier pivot

Edits since v0.9.12
- Thread 30 introduced: Busless architecture pivot — retire the broker/bus from castra-core; move user interaction to the Codex harness with a vizier agent managing VMs over SSH. Added cutover acceptance and cross-links.
- Thread 20 pivoted: UI ↔ Core integration becomes Harness ↔ Core integration (vizier-first). UI may subscribe to the harness stream; direct UI→core wiring is de-scoped for now.
- Event Contract v1 scope updated: remove broker/bus families; add vizier.ssh* event family and version preamble requirement. Golden tests shift to reflect busless runtime.

Active threads (intent + acceptance deltas)
- Thread 2 — Cooperative shutdown lifecycle: unchanged.

- Thread 12 — Post-boot bootstrap pipeline: unchanged (but will consume SSH channel via vizier where relevant).

- Thread 13 — Stateless runs (ephemeral-only): unchanged.

- Thread 20 — Harness ↔ Core integration (Vizier-first) [PIVOT from UI ↔ Core]:
  Intent: The Codex harness is the front door for human interaction. It invokes castra-core operations and merges their events with vizier SSH observations into a single stream for consumers (UI/tests/automation).
  Acceptance (updated):
  - A harness session can initiate Up and receive a unified stream: core operation events + vizier.ssh events per VM. [NEXT]
  - No broker/bus launch occurs during any operation; legacy bus surfaces are non-functional with clear guidance. [BLOCKER]
  - UI integration (if present) subscribes to the harness stream instead of embedding core directly. [FOLLOW-ON]
  Anchors: castra-harness/src/{runner,session,stream,events}.rs; castra-core/src/app/{up,down,status,clean}.rs; castra-ui/src/ssh/mod.rs (prior art for SSH streaming semantics).

- Thread 21 — Operational clarity (Attention model): unchanged.

- Thread 22 — UI onboarding docs (tutorial set): pending reframe to harness-centric flows.

- Thread 30 — Busless architecture cutover (Core) [NEW]:
  Intent: Remove the broker/bus from castra-core; eliminate the common comms substrate in favor of per-VM SSH mediated by the vizier in the harness.
  Acceptance:
  - Core operations Up/Down/Status/Clean/Bootstrap run without starting or depending on a broker; no bus logs or handshake directories are created. [BLOCKER]
  - CLI bus commands (broker/bus publish/tail) are retired or emit deprecation guidance without side effects; help/manpages/docs reflect the removal. [NEXT]
  - Tests referencing broker/bus are removed or replaced; CI green without broker artifacts. [NEXT]
  - Event Contract v1 has no broker/bus events; vizier.ssh events cover per-VM observations. [COORDINATED with Thread 20]
  Anchors: castra-core/src/core/operations/bus.rs; castra-core/src/core/broker.rs; castra-core/src/app/broker.rs; castra-core/tests/broker_contract.rs; scripts/castra-bus-*.sh.

Current code state (observable surfaces)
- Core currently emits structured JSON for operations and still contains a broker/bus implementation (TCP broker with JSON frames and file-backed logs). operations::up_with_launcher accepts an injectable BrokerLauncher for embedding.
- UI scaffolding exists; there is an SSH manager implementation in castra-ui (SshManager) that demonstrates per-VM SSH streaming. The harness crate provides a session/runner/event pipeline but is not yet the exclusive front door.

Narrative themes
1) Robust lifecycle; 10) Trustworthy bootstrap; 12) Day‑1 productivity; 13) Ephemeral-only policy; 20) Harness-first integration; 21) Operational clarity; 22) Onboarding via tutorials; 30) Architectural simplicity (busless vizier).

Direction of travel
- Remove broker/bus from the core (Thread 30) and pivot integration to the Codex harness. Freeze Event Contract v1 sans broker/bus and add vizier.ssh events with a version preamble. Then deliver a harness-driven Up vertical slice that merges core + SSH events, with UI subscribing as a consumer if needed.

Cross-links
- Bus surfaces to retire: castra-core/src/core/operations/bus.rs; castra-core/src/core/broker.rs; castra-core/src/app/broker.rs; castra-core/tests/broker_contract.rs; scripts/castra-bus-*.sh.
- Vizier prior art: castra-ui/src/ssh/mod.rs; Harness integration points: castra-harness/src/{session,stream,events}.rs.

Editorial housekeeping
- Several TODOs reference UI↔core embedding; these are being pivoted to harness-first. Duplicate TODO files remain and will be cleaned as part of the cutover.