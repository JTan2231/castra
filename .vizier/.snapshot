SNAPSHOT v0.10.0-pre — Castra (Agent-centric orchestration) — Busless vizier pivot

Edits since previous snapshot
- UI advances on attention/noise control and operator ergonomics:
  - Collapsible Reasoning/Tool outputs with click-to-expand previews; stick-to-bottom + scroll listener; soft log limit with truncation notice.
  - Distinct Vizier System vs Vizier Command message kinds; Stop control during active Codex turn; token usage summaries (Codex/Vizier) in footer.
  - Chat transcripts now recorded to <workspace_root>/.castra/transcripts/*.jsonl (see README update).
- vm_commands.sh gains `--wait` streaming mode and `view-output` helper for stdout/stderr retrieval; usage strings updated.
- No core/harness structural changes yet; UI now consumes HarnessEvent more fully and renders Vizier activity distinctly.

Active threads (intent + acceptance deltas)
- Thread 2 — Cooperative shutdown lifecycle: unchanged.

- Thread 12 — Post-boot bootstrap pipeline: unchanged.

- Thread 13 — Stateless runs (ephemeral-only): unchanged.

- Thread 20 — Harness ↔ Core integration (Vizier-first): progress in consumers
  - Evidence: UI pumps HarnessEvent (pump_codex/pump_vizier) and renders Vizier command/system outputs; transcripts capture these.
  - Gap: unified agent-addressed stream still originates UI-side for SSH; harness-side vizier.ssh.* stream + version preamble and golden tests remain outstanding.

- Thread 21 — Operational clarity (Attention model): partial delivery
  - Evidence: Collapsible messages, scroll behavior, and log soft limit reduce noise and protect responsiveness.
  - Gap: Event grouping/coalescing and per-agent context panes not yet shipped.

- Thread 22 — UI onboarding docs (tutorial set): unchanged.

- Thread 30 — Busless architecture cutover (Core): unchanged; bus-era artifacts remain in core options and scripts; scripts cleanup TODO open.

- Thread 31 — Agent-first interaction model: in progress (consumers); blockers remain
  - Evidence: UI distinguishes Vizier activity and tallies usage; foundation for agent-addressed flow.
  - Gap: Roster still VM-centric; CLI/core still expose VM-selection surfaces.

Current code state (observable surfaces)
- Core: options.rs still contains broker/bus-related types and VM-oriented options; broker/bus modules/tests/scripts exist.
- Harness: Unified, agent-addressed stream not yet implemented; SSH integration remains UI-side. No change in harness code structure.
- UI:
  - message_log: collapsible Reasoning/Tool messages; click-to-expand; truncation notice; improved scroll handling.
  - state: new MessageKind::VizierCommand; token usage tracking; transcript writer integration.
  - shell/prompt: Stop control during active Codex turn; wider default window.
  - vm_fleet.rs remains VM-centric; agent roster not yet present.
- Tooling: vm_commands.sh supports `--wait` and `view-output` to stream and later fetch outputs.
- Docs: README documents transcript recording location and schema summary.

Narrative themes
- Busless, agent-first pivot remains the north star. Current increment invests in UX affordances to handle higher event volume and set up verifiable streams via transcripts and vm_commands.sh.

Direction of travel
- Next increments: move SSH/vizier stream into harness with versioned preamble and golden tests (Thread 20); pivot UI roster to agents and add grouping (Threads 31, 21); begin pruning bus-era scripts and options (Thread 30).

Cross-links
- Thread 20: castra-harness/src/{session.rs,runner.rs,stream.rs,events.rs,translator.rs}; UI consumer in castra-ui/src/app/mod.rs (pump_codex/pump_vizier). Tooling anchor: vm_commands.sh.
- Thread 21: castra-ui/src/components/{message_log.rs,shell.rs}; castra-ui/src/state/mod.rs.
- Thread 30: castra-core/src/core/options.rs; scripts/* bus-era artifacts.
- Thread 31: castra-ui/src/components/roster_sidebar.rs and vm_fleet.rs (to be replaced/pivoted).

Editorial housekeeping
- Canonical TODOs retained and updated with concrete evidence and gaps for Threads 20/21; no new threads opened. Remaining TODO list continues to be authoritative.